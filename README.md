# 基于图谱增强的RAG电力系统知识应用（Graph-Enhanced RAG for Power System Knowledge）

本项目实现了一个检索增强生成（RAG）系统，并结合了知识图谱增强功能，专门用于查询与电力系统相关的信息。它结合了基于向量相似度搜索和基于图推理的优势，以提供更准确和全面的答案。

## 功能特性

*   **混合搜索：** 将向量相似度搜索（使用 FAISS）与图遍历相结合，以检索相关上下文。
*   **知识图谱：** 从文档中提取实体和关系，构建知识图谱（使用 NetworkX），捕捉概念之间的联系。
*   **文档处理：** 处理 Markdown 文件，智能地将文本分块以进行最佳索引。
*   **PDF 智能转 Markdown：** 支持将 PDF 自动转换为 Markdown，并通过本地多模态模型（如 `qwen3-vl:8b/30b`）识别公式与附图说明。
*   **答案生成：** 使用大型语言模型（Ollama 和deepseek-r1:7b）根据检索到的上下文合成答案。
*   **持久化：** 保存和加载向量索引和知识图谱，以便高效地重复使用。
*   **错误处理：** 包含针对文档处理和 JSON 解析的健壮错误处理。
*   **可定制：** 轻松调整参数，例如检索结果的数量 (top_k)、温度和 LLM 模型。

## 安装

1.  **先决条件：**
    *   Python 3.7+
    *   安装并运行 Ollama。从 [https://ollama.ai/](https://ollama.ai/) 下载。
    *   安装deepseek的本地版本（根据你的电脑显卡配置，如果是4090可以选择更高的deepseek版本）
    ```bash
     ollama run deepseek-r1:7b
    ```

    *   安装所需的 Python 包：

        ```bash
        pip install -r requirements.txt
        ```
        创建一个 `requirements.txt` 文件，内容如下：
        ```
        networkx
        sentence-transformers
        markdown
        beautifulsoup4
        jieba
        numpy
        faiss-cpu  # 如果你有支持 CUDA 的 GPU，则使用 faiss-gpu
        ollama
        pymupdf
        ```
2.  **克隆仓库：**

    ```bash
    git clone <你的仓库 URL>
    cd <你的仓库名称>
    ```

3.  **将您的 Markdown/PDF 文档放入 `data/` 目录。** 我目前放了几篇发表在"深入理解电力系统"公众号的文章
4.  如果需要 PDF 转换能力，请先在 Ollama 中拉取并运行多模态模型，例如：
    ```bash
    ollama run qwen3-vl:8b
    ```

## 使用方法

1.  **运行应用程序：**

    ```bash
    python main.py
    ```

2.  第一次运行脚本时，它将先把 `data/` 目录中的 PDF 转换为 Markdown（公式输出为 LaTeX，附图转为简要描述），再统一处理 Markdown 文档，构建向量索引和知识图谱，并将它们保存到 `model_files/` 目录。这可能需要一些时间，具体取决于您的文档大小和硬件。

3.  后续运行将加载预先构建的索引和图（速度更快）。

4.  脚本将提示您输入问题。键入您的问题并按 Enter 键。

5.  要退出，请输入“退出”。

## 示例

### 提问

电力系统调度系统的历史？

### 回答

电力系统调度系统的早期历史可以分为以下几个关键时期：

1. **计算机应用的开端**（1970年）
   - 美国新英格兰电网是最早将计算机用于电网调度控制的案例。这一技术标志着调度自动化从手动监控向智能化管理的转变。

2. **中国起步与探索**
   - 1978年，南京自动化研究所研制的SD-176系统在京津唐电网应用，具备监控功能但未形成完整系统。
   - 浙江大学和电科院的研究团队对状态估计等高级应用进行了研究，并于1979-1980年间派队到魁北克进修，以提升调度自动化技术水平。

这些阶段奠定了中国电力系统调度技术的基础，并为后续的发展提供了重要参考。
